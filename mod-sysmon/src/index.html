<!DOCTYPE html>
<html lang="en">
  <head>
  
    <link href="css/bootstrap.css" rel="stylesheet" >
	<script type="text/javascript" ="js/bootstrap.js"></script>	
	
	
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script src="http://cdn.sockjs.org/sockjs-0.3.min.js"></script>

	<script>
		var sock = new SockJS('http://www.notdol.com:9090/echo');

		// type : 'subscribe'
		// data : jsonObject
		// 

		sock.onopen = function(){
			// 
			console.log('=========== sock open ===============');
		}

		sock.onmessage = function(e){
			console.log('sock message ===== '+e.data);
		}

		sock.onclose = function(){
			console.log('=========== sock close ===============');
		}

	</script>


    <script type="text/javascript">
		google.load("visualization", "1", {packages:["corechart"]});

		google.setOnLoadCallback(chartLoad);
	    var options;
		var data;

		var idx = 0;
		// visual refresh interval
		var dataRefreshInterval = 2000;
		var insertData = [];

		// serverId, serverName
		var servers = [0,1,2];

		// 서버를 추가한다.
		function addServer(serverId, serverName){
			var isExist = false;
			servers.forEach(function(item){
				if(item.serverId == serverId) isExist = true;
			})

			if(!isExist){
				data.addColumn('number',serverName,serverId);
				servers.push(serverId);
			}
		}

		//서버를 제거한다. 
		function removeServer(){

		}

		//서버의 상태 정보가 추가 된다. 
		function serverStat(serverId, time, memory){
			var idx = 0;
			var insertData = [];
			insertData.push(time);
			for(var i = 1 ;i < servers.length;i++){
				if(data.getColumnId(i) == serverId) {insertData.push(memory)}
				else insertData.push(data.getValue(data.getNumberOfRows()-1,i));
			}
			data.addRow(insertData);
		}

		function chartLoad(){
			options = {
	      width: 800,
	      height: 600,
	      animation:{
	        duration: 1000,
	        easing: 'out',
	      },
	      vAxis: {minValue:0, maxValue:1000}
	    };

		    data = new google.visualization.DataTable();
			data.addColumn('number','Year',0);
			data.addColumn('number','Sales',1);
			data.addColumn('number','Expenses',2);
			data.addRow([2001, 200,200]);
			data.addRow([2002, 500,500]);


			//data.setValue(idx,0,2001);
			//data.setValue(idx,1,2001);
			//data.setValue(idx++,2,2001);

			drawChart();

			setInterval(drawChart,2000);
			setInterval(adS,5000);
			setInterval(stat,dataRefreshInterval);
		}


		function adS(){
			addServer('newServer','newServer');
		}

		function stat(){
			serverStat('newServer', year++,700);
		}


		var year = 2002

		function drawChart() {
			//data.addRow([++year,500,500]);
			//data.setValue(idx,0,++year);
			//data.setValue(idx,1,year);
			//data.setValue(idx++,2,year);

			var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

			chart.draw(data, options);
		}


    </script>
  </head>
  <body>
  
<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Project name</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="#">Action</a></li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Nav header</li>
                  <li><a href="#">Separated link</a></li>
                  <li><a href="#">One more separated link</a></li>
                </ul>
              </li>
            </ul>
            <form class="navbar-form pull-right">
              <input class="span2" type="text" placeholder="Email">
              <input class="span2" type="password" placeholder="Password">
              <button type="submit" class="btn">Sign in</button>
            </form>
            
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>  
    
  <div class="input-append">
  <input class="span2" id="appendedInputButton" type="text">
  <button class="btn" type="button">Go!</button>
</div><br /><br /><br /><br />
  <div id="chart_div" style="width: 900px; height: 500px;"></div>
 
 
     <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="js/bootstrap.min.js"></script>
 
  </body>
</html>
